<div class="page-container">
  <div class="page-header">
    <h1 class="page-title">Análisis de Imágenes</h1>
    <p class="page-subtitle">Cargue una imagen de una cámara trampa para detectar y clasificar la fauna silvestre.</p>
  </div>

  <iframe src="https://3a6d4e4baacd7a48b4.gradio.live/" width="100%" height="500px"></iframe>

  <div class="analysis-container">
    <!-- Columna de Carga -->
    <div class="upload-column">
      <div class="upload-area" 
           (click)="fileInput.click()"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)"
           (drop)="onDrop($event)"
           [class.drag-over]="isDragOver">
        
        <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/jpeg, image/png" style="display: none;">

        <div *ngIf="!imagePreviewUrl" class="upload-instructions">
          <div class="upload-icon">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l-3 3m3-3l3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" />
            </svg>
          </div>
          <h3>Arrastre y suelte una imagen aquí</h3>
          <p>o haga clic para seleccionar un archivo</p>
          <span class="file-types">JPG, PNG</span>
        </div>

        <div *ngIf="imagePreviewUrl" class="image-preview-container">
          <img [src]="imagePreviewUrl" alt="Vista previa de la imagen cargada" class="image-preview">
        </div>
      </div>

      <button class="analyze-button" [disabled]="!selectedFile || isLoading" (click)="analizar()">
        <span *ngIf="!isLoading">Clasificar Imagen</span>
        <span *ngIf="isLoading" class="loading-spinner"></span>
      </button>

      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>
    </div>

    <!-- Columna de Resultados -->
    <div class="results-column">
      <div *ngIf="!result && !isLoading" class="results-placeholder">
        <div class="placeholder-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
          </svg>
        </div>
        <h3>Los resultados aparecerán aquí</h3>
        <p>Cargue una imagen y haga clic en "Clasificar" para ver la predicción de la IA.</p>
      </div>

      <div *ngIf="isLoading" class="results-loading">
        <div class="loading-spinner large"></div>
        <h4>Analizando...</h4>
        <p>Nuestro modelo está identificando la especie. Esto puede tardar unos segundos.</p>
      </div>

      <div *ngIf="result" class="results-content">
        <h3 class="results-title">Resultados del Análisis</h3>
        
        <div class="top-prediction">
          <h4>Principal Predicción</h4>
          <p class="species-name">{{ result.predictions[0].species }}</p>
          <div class="confidence-bar">
            <div class="confidence-fill" [style.width.%]="result.predictions[0].confidence"></div>
          </div>
          <p class="confidence-label">{{ result.predictions[0].confidence | number:'1.1-1' }}% de confianza</p>
        </div>

        <div class="other-predictions" *ngIf="result.predictions.length > 1">
          <h4>Otras Posibilidades</h4>
          <ul>
            <li *ngFor="let pred of result.predictions.slice(1)">
              <span class="other-species">{{ pred.species }}</span>
              <span class="other-confidence">{{ pred.confidence | number:'1.1-1' }}%</span>
            </li>
          </ul>
        </div>
      </div>

    </div>
  </div>
</div>